<div id="fbb8d316-18ff-4832-a503-4fe09a054100">
  <p>Say “{{Front}}”</p>

  <button disabled onclick="listen()">Listen</button>

  <p>
    <div class="warning">Run this in a browser that supports speech recognition</div>
    <div class="transcript"></div>
    <div class="confidence"></div>
  </p>
</div>

<script>
{
  const getSpeechRecognition = function() {
    if (window.SpeechRecognition !== undefined) {
      return SpeechRecognition
    }
    if (window.webkitSpeechRecognition !== undefined) {
      return new webkitSpeechRecognition()
    }
    return null
  }

  const recognition = getSpeechRecognition()
  if (recognition !== null) {
    const root = document.getElementById('fbb8d316-18ff-4832-a503-4fe09a054100')
    root.querySelector('.warning').innerText = ''

    const button = root.querySelector('button')
    button.disabled = false
    recognition.lang = 'zh-CN'
    recognition.onspeechend = () => recognition.stop()
    recognition.onresult = event => {
      button.innerText = 'Listen'
      const result = event.results[0][0]
      root.querySelector('.transcript').innerText = 'Transcript: ' + result.transcript
      window.answer = result.transcript
      const confidence = result.confidence * 100
      const confidenceEl = root.querySelector('.confidence')
      confidenceEl.innerText = `Confidence: ${confidence.toFixed(1)}%`
      const color = confidence > 90 ? 'green' : 'red'
      confidenceEl.style = `color: ${color}`
    }

    window.listen = function() {
      button.innerText = 'Listening...'
      recognition.start()
    }
  }
}
</script>

<!-- ********************************************************************** -->

{{Front}}

<hr id="answer">

{{Front}}

<p>
  Your answer: <span id="db7bbb8f-1709-4f9e-9c84-11d267a4b556"></span>
</p>

<script>
{
  const answer = typeof window.answer === 'string' ? window.answer.trim() : ''
  const answerEl = document.getElementById('db7bbb8f-1709-4f9e-9c84-11d267a4b556')
  answerEl.innerText = answer === "" ? "(blank)" : answer
  const color = answer === '{{Front}}' ? 'green' : 'red'
  answerEl.style = `color: ${color}`
}
</script>
